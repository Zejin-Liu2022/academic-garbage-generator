<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å†™ä½œ AI åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/theme.js"></script>
    <!-- Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* æ¨¡æ‹ŸWordçš„é¡µé¢æ ·å¼ */
        .paper-page {
            position: relative; /* å…³é”®ï¼šç¡®ä¿å­å…ƒç´  offsetTop ç›¸å¯¹äºé¡µé¢è®¡ç®— */
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            font-family: "Times New Roman", "SimSun", serif;
            line-height: 1.5;
            color: #000;
        }
        /* åŠ è½½åŠ¨ç”» */
        .typing-cursor::after {
            content: '|';
            animation: blink 1s step-start infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* å‚è€ƒæ–‡çŒ®æ ·å¼ä¼˜åŒ– */
        .references {
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid #e2e8f0;
        }
        .references h3 {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 12px;
            text-indent: 0 !important;
        }
        .references p, .references li {
            text-indent: 0 !important; /* å¼ºåˆ¶å–æ¶ˆé¦–è¡Œç¼©è¿› */
            margin-bottom: 8px;
            font-size: 14px;
            line-height: 1.6;
            color: #334155;
            text-align: left;
        }
        .references ul, .references ol {
            padding-left: 0;
            list-style: none;
        }

        /* è®ºæ–‡æ­£æ–‡æ ¼å¼ä¼˜åŒ– - éµå¾ªå›½æ ‡æ’ç‰ˆ */
        .paper-page p {
            text-indent: 2em; /* é¦–è¡Œç¼©è¿› */
            text-align: justify; /* ä¸¤ç«¯å¯¹é½ */
            margin-bottom: 1em; /* æ®µè½é—´è· */
            font-size: 12pt; /* å°å››å·å­— */
        }
        
        /* æ ‡é¢˜æ ·å¼ */
        .paper-page h1 {
            text-align: center;
            font-size: 22pt; /* äºŒå·å­— */
            font-weight: bold;
            margin-bottom: 24px;
            font-family: "SimHei", "STHeiti", sans-serif; /* æ ‡é¢˜é€šå¸¸ç”¨é»‘ä½“ */
            text-indent: 0 !important;
        }
        .paper-page h2 {
            font-size: 16pt; /* ä¸‰å·å­— */
            font-weight: bold;
            margin-top: 1.5em;
            margin-bottom: 0.8em;
            font-family: "SimHei", "STHeiti", sans-serif;
            text-indent: 0 !important;
        }
        .paper-page h3 {
            font-size: 14pt; /* å››å·å­— */
            font-weight: bold;
            margin-top: 1em;
            margin-bottom: 0.5em;
            font-family: "SimHei", "STHeiti", sans-serif;
            text-indent: 0 !important;
        }
        .paper-page h4 {
            font-size: 12pt; /* å°å››å·åŠ ç²— */
            font-weight: bold;
            margin-top: 1em;
            margin-bottom: 0.5em;
            text-indent: 0 !important;
        }

        /* æ‘˜è¦ä¸å…³é”®è¯ */
        .paper-page .abstract, .paper-page .keywords {
            font-size: 10.5pt; /* äº”å·å­— */
            margin-bottom: 1em;
            padding: 0 2em; /* å·¦å³ç¼©è¿›ï¼Œä½¿æ‘˜è¦æ¯”æ­£æ–‡çª„ */
            text-indent: 0; /* æ‘˜è¦æ•´ä½“ä¸ç¼©è¿›ï¼Œå†…éƒ¨æ–‡å­—å¯èƒ½ç¼©è¿› */
        }
        .paper-page .abstract strong, .paper-page .keywords strong {
            font-family: "SimHei", "STHeiti", sans-serif;
        }

        /* å‚è€ƒæ–‡çŒ®ç‰¹æ®Šå¤„ç† */
        .references h4 {
            text-align: center; /* å‚è€ƒæ–‡çŒ®æ ‡é¢˜å±…ä¸­ */
            margin-top: 2em;
            border-top: 1px solid #000; /* ä¼ ç»Ÿåˆ†å‰²çº¿ */
            padding-top: 1em;
        }

        /* ä¿®å¤åˆ—è¡¨æ ·å¼è¢« Tailwind é‡ç½®çš„é—®é¢˜ */
        .paper-page ul {
            list-style-type: disc;
            padding-left: 2em;
            margin-bottom: 1em;
        }
        .paper-page ol {
            list-style-type: decimal;
            padding-left: 2em;
            margin-bottom: 1em;
        }
        .paper-page li {
            text-indent: 0 !important; /* åˆ—è¡¨é¡¹å–æ¶ˆé¦–è¡Œç¼©è¿› */
            margin-bottom: 0.5em;
        }

        /* èŠå¤©æ¶ˆæ¯åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-900 h-screen flex flex-col overflow-hidden transition-colors duration-200">

    <!-- å·¥å…·æ  -->
    <header class="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 h-16 flex items-center justify-between px-4 z-20 shadow-sm transition-colors duration-200">
        <div class="flex items-center gap-4">
            <button onclick="openNavSidebar()" class="text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition">
                <i class="fas fa-bars text-lg"></i>
            </button>
            <input id="headerTitle" type="text" value="æœªå‘½åæ–‡æ¡£" 
                   class="font-bold text-slate-700 dark:text-slate-200 border-none focus:ring-0 text-lg bg-transparent hover:bg-slate-50 dark:hover:bg-slate-700 rounded px-2 truncate transition-all duration-200"
                   style="max-width: 400px; min-width: 150px;">
            <span id="saveStatus" class="text-xs text-slate-400 bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded">å·²ä¿å­˜</span>
            
            <!-- å­—æ•°ç»Ÿè®¡ -->
            <div id="docStats" class="hidden md:flex items-center gap-3 ml-2 text-xs text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-700/50 px-2 py-1 rounded border border-slate-100 dark:border-slate-700">
                <span title="æ€»å­—æ•°"><i class="fas fa-font mr-1.5 text-slate-400"></i><span id="wordCount" class="font-medium">0</span> å­—</span>
                <div class="w-px h-3 bg-slate-300 dark:bg-slate-600"></div>
                <span title="æ®µè½æ•°"><i class="fas fa-paragraph mr-1.5 text-slate-400"></i><span id="paraCount" class="font-medium">0</span> æ®µ</span>
            </div>
        </div>

        <!-- å¯¹åº”æ–‡æ¡£éœ€æ±‚ï¼šå¯¼å‡ºæ ¼å¼ -->
        <div class="flex items-center gap-3">
            <button onclick="undoOperation()" class="flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded" title="æ’¤é”€ä¸Šä¸€æ­¥æ“ä½œ">
                <i class="fas fa-undo text-slate-500 dark:text-slate-400"></i> æ’¤é”€
            </button>
            <button onclick="copyFullText()" class="flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded">
                <i class="fas fa-copy text-slate-600 dark:text-slate-400"></i> å¤åˆ¶å…¨æ–‡
            </button>
            <button onclick="exportToWord()" class="flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded">
                <i class="fas fa-file-word text-blue-600 dark:text-blue-400"></i> å¯¼å‡º Word
            </button>
            <button onclick="exportToPDF()" class="flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded">
                <i class="fas fa-file-pdf text-red-600 dark:text-red-400"></i> å¯¼å‡º PDF
            </button>
            
            <div class="h-6 w-px bg-slate-200 dark:bg-slate-700"></div>

            <button onclick="openSettings()" class="text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors p-2">
                <i class="fas fa-cog text-lg"></i>
            </button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <!-- å·¦ä¾§ï¼šAI æ§åˆ¶é¢æ¿ (å¯¹åº”æ–‡æ¡£åŠŸèƒ½æ€§éœ€æ±‚) -->
        <aside class="w-80 bg-white dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 flex flex-col z-10 transition-colors duration-200">
            
            <!-- æ–‡ç« å¤§çº²åŒºåŸŸ -->
            <div id="sidebarOutline" class="flex-1 flex flex-col min-h-0">
                <div class="p-3 bg-slate-50 dark:bg-slate-900 font-bold text-slate-700 dark:text-slate-200 text-sm border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                    <span><i class="fas fa-list-ul mr-2 text-blue-500"></i>æ–‡ç« å¤§çº²</span>
                    <button onclick="updateOutline()" class="text-slate-400 hover:text-blue-500 transition" title="åˆ·æ–°å¤§çº²">
                        <i class="fas fa-sync-alt text-xs"></i>
                    </button>
                </div>
                <div id="articleOutline" class="flex-1 overflow-y-auto p-4 space-y-1">
                    <p class="text-xs text-slate-400 text-center mt-4">æš‚æ— å¤§çº²å†…å®¹</p>
                </div>
            </div>

            <!-- Resizer 1 -->
            <div id="resizerSettings" class="h-1.5 bg-slate-100 dark:bg-slate-700 cursor-row-resize hover:bg-blue-400 dark:hover:bg-blue-500 transition-colors z-20 flex-none"></div>

            <div id="sidebarSettings" class="flex-none overflow-y-auto" style="height: auto; max-height: 60vh;">
                <div class="p-4">
                    <h3 class="font-bold text-slate-700 dark:text-slate-200 mb-4"><i class="fas fa-robot text-blue-500 mr-2"></i>å†™ä½œè®¾ç½®</h3>
                    
                    <!-- å†™ä½œæ¨¡å¼ -->
                    <div class="mb-4">
                        <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase mb-2">å†™ä½œæ¨¡å¼</label>
                        <select id="modeSelect" class="w-full border-slate-300 dark:border-slate-600 rounded-lg text-sm p-2 bg-slate-50 dark:bg-slate-700 dark:text-white border focus:border-blue-500 outline-none">
                            <option value="outline">æ€è·¯å¼•å¯¼ (ç”Ÿæˆæçº²)</option>
                            <option value="write" selected>å¿«é€Ÿæˆæ–‡ (ç”Ÿæˆå†…å®¹)</option>
                            <option value="polish">å†…å®¹æ¶¦è‰² (ä¿®æ”¹æ‰©å†™)</option>
                        </select>
                    </div>

                    <!-- å¼•ç”¨æ ¼å¼ -->
                    <div class="mb-4">
                        <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase mb-2">å¼•ç”¨è§„èŒƒ</label>
                        <select id="citationSelect" class="w-full border-slate-300 dark:border-slate-600 rounded-lg text-sm p-2 bg-slate-50 dark:bg-slate-700 dark:text-white border focus:border-blue-500 outline-none">
                            <option value="GB/T 7714">GB/T 7714 (ä¸­å›½æ ‡å‡†)</option>
                            <option value="APA 7th">APA 7th (å¿ƒç†/æ•™è‚²)</option>
                            <option value="MLA 9th">MLA 9th (æ–‡å­¦/è‰ºæœ¯)</option>
                        </select>
                    </div>

                    <!-- é£æ ¼ä¸å­—æ•° -->
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase mb-2">é£æ ¼</label>
                            <select id="styleSelect" class="w-full border-slate-300 dark:border-slate-600 rounded-lg text-sm p-2 bg-slate-50 dark:bg-slate-700 dark:text-white border focus:border-blue-500 outline-none">
                                <option value="å­¦æœ¯ä¸¥è°¨">å­¦æœ¯ä¸¥è°¨</option>
                                <option value="é€šä¿—æ˜“æ‡‚">é€šä¿—æ˜“æ‡‚</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase mb-2">å­—æ•°</label>
                            <input id="wordCountInput" type="number" placeholder="2000" class="w-full border-slate-300 dark:border-slate-600 rounded-lg text-sm p-2 bg-slate-50 dark:bg-slate-700 dark:text-white border focus:border-blue-500 outline-none">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resizer 2 -->
            <div id="resizerInput" class="h-1.5 bg-slate-100 dark:bg-slate-700 cursor-row-resize hover:bg-blue-400 dark:hover:bg-blue-500 transition-colors z-20 flex-none"></div>

            <!-- è¾“å…¥æç¤ºåŒº -->
            <div id="sidebarInput" class="flex-none h-80 flex flex-col bg-slate-50 dark:bg-slate-900 transition-colors duration-200">
                <div class="p-4 flex-1 flex flex-col">
                    <label class="block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2">è¾“å…¥ä¸»é¢˜æˆ–æŒ‡ä»¤</label>
                    <textarea id="promptInput" class="flex-1 w-full border border-slate-300 dark:border-slate-600 rounded-lg p-3 text-sm dark:bg-slate-800 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none resize-none mb-3" placeholder="ä¾‹å¦‚ï¼šè¯·å¸®æˆ‘å†™ä¸€ç¯‡å…³äºâ€˜ç”Ÿæˆå¼AIåœ¨æ•™è‚²é¢†åŸŸåº”ç”¨â€™çš„è®ºæ–‡æçº²ï¼ŒåŒ…å«3ä¸ªä¸»è¦ç« èŠ‚..."></textarea>
                    
                    <!-- æ¨¡æ‹ŸæŸ¥é‡é¢„è­¦ -->
                    <div class="flex items-center gap-2 mb-3 text-xs text-orange-600 bg-orange-50 p-2 rounded border border-orange-100">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>æ³¨æ„ï¼šç”Ÿæˆå†…å®¹è¯·åŠ¡å¿…äººå·¥æ ¸å¯¹äº‹å®ã€‚</span>
                    </div>

                    <button onclick="generateContent()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2.5 rounded-lg shadow-lg transition flex items-center justify-center gap-2">
                        <i class="fas fa-magic"></i> å¼€å§‹ç”Ÿæˆ
                    </button>
                </div>
            </div>
        </aside>

        <!-- ä¸­é—´ï¼šæ–‡æ¡£ç¼–è¾‘é¢„è§ˆåŒº -->
        <main class="flex-1 flex flex-col bg-slate-100 dark:bg-slate-900 transition-colors duration-200 relative">
            <!-- æ ¼å¼å·¥å…·æ  -->
            <div class="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 p-2 flex items-center justify-center gap-1 shadow-sm z-10 sticky top-0">
                <!-- å­—ä½“æ ·å¼ -->
                <div class="flex items-center bg-slate-100 dark:bg-slate-700 rounded-lg p-1">
                    <button onclick="formatDoc('bold')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition" title="åŠ ç²—">
                        <i class="fas fa-bold"></i>
                    </button>
                    <button onclick="formatDoc('italic')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition" title="æ–œä½“">
                        <i class="fas fa-italic"></i>
                    </button>
                    <button onclick="formatDoc('underline')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition" title="ä¸‹åˆ’çº¿">
                        <i class="fas fa-underline"></i>
                    </button>
                    <button onclick="formatDoc('strikeThrough')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition" title="åˆ é™¤çº¿">
                        <i class="fas fa-strikethrough"></i>
                    </button>
                </div>

                <div class="w-px h-6 bg-slate-300 dark:bg-slate-600 mx-2"></div>

                <!-- å­—å· -->
                <div class="flex items-center bg-slate-100 dark:bg-slate-700 rounded-lg p-1">
                    <button onclick="formatDoc('fontSize', '3')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition text-sm" title="æ­£å¸¸">
                        <i class="fas fa-font"></i>
                    </button>
                    <button onclick="formatDoc('fontSize', '5')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition text-lg" title="å¤§å·">
                        <i class="fas fa-font"></i>
                    </button>
                </div>

                <div class="w-px h-6 bg-slate-300 dark:bg-slate-600 mx-2"></div>

                <!-- å¯¹é½æ–¹å¼ -->
                <div class="flex items-center bg-slate-100 dark:bg-slate-700 rounded-lg p-1">
                    <button onclick="formatDoc('justifyLeft')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition" title="å·¦å¯¹é½">
                        <i class="fas fa-align-left"></i>
                    </button>
                    <button onclick="formatDoc('justifyCenter')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition" title="å±…ä¸­">
                        <i class="fas fa-align-center"></i>
                    </button>
                    <button onclick="formatDoc('justifyRight')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition" title="å³å¯¹é½">
                        <i class="fas fa-align-right"></i>
                    </button>
                    <button onclick="formatDoc('justifyFull')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition" title="ä¸¤ç«¯å¯¹é½">
                        <i class="fas fa-align-justify"></i>
                    </button>
                </div>

                <div class="w-px h-6 bg-slate-300 dark:bg-slate-600 mx-2"></div>

                <!-- åˆ—è¡¨ -->
                <div class="flex items-center bg-slate-100 dark:bg-slate-700 rounded-lg p-1">
                    <button onclick="formatDoc('insertUnorderedList')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition" title="æ— åºåˆ—è¡¨">
                        <i class="fas fa-list-ul"></i>
                    </button>
                    <button onclick="formatDoc('insertOrderedList')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition" title="æœ‰åºåˆ—è¡¨">
                        <i class="fas fa-list-ol"></i>
                    </button>
                </div>
                
                <div class="w-px h-6 bg-slate-300 dark:bg-slate-600 mx-2"></div>

                <!-- ç¼©è¿› -->
                <div class="flex items-center bg-slate-100 dark:bg-slate-700 rounded-lg p-1">
                    <button onclick="formatDoc('outdent')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition" title="å‡å°‘ç¼©è¿›">
                        <i class="fas fa-outdent"></i>
                    </button>
                    <button onclick="formatDoc('indent')" class="p-2 rounded hover:bg-white dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 transition" title="å¢åŠ ç¼©è¿›">
                        <i class="fas fa-indent"></i>
                    </button>
                </div>

                <div class="w-px h-6 bg-slate-300 dark:bg-slate-600 mx-2"></div>

                <!-- ç¼©æ”¾æ§åˆ¶ -->
                <div class="flex items-center bg-slate-100 dark:bg-slate-700 rounded-lg p-1 gap-2 px-3">
                    <i class="fas fa-search-minus text-slate-400 text-xs"></i>
                    <input type="range" id="zoomSlider" min="60" max="500" value="100" step="10" class="w-24 h-1 bg-slate-300 rounded-lg appearance-none cursor-pointer accent-blue-600" oninput="updateZoom(this.value)">
                    <i class="fas fa-search-plus text-slate-400 text-xs"></i>
                    <div class="flex items-center border-l border-slate-300 dark:border-slate-600 pl-2 ml-1">
                        <input type="number" id="zoomInput" min="60" max="500" value="100" class="w-12 bg-transparent text-xs text-center font-medium text-slate-600 dark:text-slate-300 outline-none" onchange="updateZoom(this.value)">
                        <span class="text-xs text-slate-400">%</span>
                    </div>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-8 flex justify-center">
                <div id="pages-container" class="flex flex-col items-center gap-8 pb-8 w-full">
                <div id="documentEditor" class="paper-page content-editable outline-none" contenteditable="true">
                    <h1 style="text-align: center; font-size: 22px; font-weight: bold; margin-bottom: 24px;">æ­¤å¤„å°†ç”Ÿæˆè®ºæ–‡æ ‡é¢˜</h1>
                    
                    <p class="text-slate-400 italic text-center" id="placeholder-text">
                        åœ¨å·¦ä¾§è¾“å…¥ä¸»é¢˜å¹¶ç‚¹å‡»â€œå¼€å§‹ç”Ÿæˆâ€ï¼ŒAI å°†ä¸ºæ‚¨è¾…åŠ©å†™ä½œ...<br>
                        æ”¯æŒè‡ªåŠ¨æ’ç‰ˆå’Œå‚è€ƒæ–‡çŒ®æ’å…¥ã€‚
                    </p>
                    
                    <div id="generated-content" class="text-justify"></div>
                </div>
            </div>
            </div>
        </main>

        <!-- å³ä¾§ï¼šå‚è€ƒæ–‡çŒ®ä¸èµ„æº (å¯¹åº”æ–‡æ¡£ å¤–éƒ¨ç³»ç»Ÿé›†æˆ) -->
        <aside class="w-64 bg-white dark:bg-slate-800 border-l border-slate-200 dark:border-slate-700 flex flex-col transition-colors duration-200">
            <div class="p-3 border-b border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 font-bold text-slate-700 dark:text-slate-200 text-sm">
                <i class="fas fa-book mr-2"></i>æ¨èå‚è€ƒæ–‡çŒ®
            </div>
            <div id="sidebarReferences" class="flex-1 p-4 overflow-y-auto space-y-4">
                <p id="no-ref-hint" class="text-xs text-slate-400 text-center mt-4">æš‚æ— å¯ç”¨æ–‡çŒ®</p>
            </div>
            
            <!-- æ ¼å¼æ£€æŸ¥åŒºåŸŸ (å›ºå®šåœ¨åº•éƒ¨) -->
            <div class="p-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50">
                <div class="text-xs text-slate-400 mb-2 uppercase font-bold">æ ¼å¼æ£€æŸ¥</div>
                <div id="headingCheckStatus" class="flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400">
                    <i class="fas fa-circle-notch fa-spin"></i> æ­£åœ¨æ£€æŸ¥æ ‡é¢˜å±‚çº§...
                </div>
            </div>
        </aside>
    </div>
    
    <!-- å¯¼èˆªä¾§è¾¹æ  (å·¦ä¾§) -->
    <div id="navOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden transition-opacity duration-300 opacity-0" onclick="closeNavSidebar()"></div>
    <div id="navSidebar" class="fixed top-0 left-0 w-72 h-full bg-white dark:bg-slate-800 shadow-2xl z-50 transform -translate-x-full transition-transform duration-300 flex flex-col">
        <div class="p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900">
            <div class="flex items-center gap-2 font-bold text-lg text-slate-800 dark:text-white">
                <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center">
                    <i class="fas fa-pen-nib text-sm"></i>
                </div>
                <span>å†™ä½œåŠ©æ‰‹</span>
            </div>
            <button onclick="closeNavSidebar()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="p-4">
            <button onclick="createNewArticle()" class="w-full bg-blue-600 text-white py-2.5 rounded-lg shadow hover:bg-blue-700 transition flex items-center justify-center gap-2 font-medium">
                <i class="fas fa-plus"></i> æ–°å»ºå†™ä½œ
            </button>
        </div>

        <!-- æ–‡ä»¶å¤¹ç®¡ç†åŒº -->
        <div class="px-4 pb-3 border-b border-slate-200 dark:border-slate-700">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-xs font-bold text-slate-400 uppercase">æ–‡ä»¶å¤¹</h3>
                <button onclick="createNewFolder()" class="text-xs text-blue-500 hover:text-blue-600 transition-colors" title="æ–°å»ºæ–‡ä»¶å¤¹">
                    <i class="fas fa-folder-plus"></i>
                </button>
            </div>
            <div id="folderList" class="space-y-1">
                <!-- æ–‡ä»¶å¤¹åˆ—è¡¨å°†é€šè¿‡ JS åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- æœç´¢å’Œç­›é€‰åŒº -->
        <div class="px-4 py-3 border-b border-slate-200 dark:border-slate-700 space-y-2">
            <div class="relative">
                <input type="text" id="searchInput" placeholder="æœç´¢æ–‡æ¡£..." 
                    class="w-full pl-8 pr-3 py-2 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none"
                    onkeyup="searchArticles(this.value)">
                <i class="fas fa-search absolute left-2.5 top-1/2 transform -translate-y-1/2 text-slate-400 text-xs"></i>
            </div>
            <div>
                <select id="sortSelect" onchange="changeSortBy(this.value)" 
                    class="w-full px-3 py-2 text-xs border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                    <option value="modified">æŒ‰ä¿®æ”¹æ—¶é—´</option>
                    <option value="created">æŒ‰åˆ›å»ºæ—¶é—´</option>
                    <option value="title">æŒ‰æ ‡é¢˜æ’åº</option>
                </select>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto px-4 pb-4">
            <h3 class="text-xs font-bold text-slate-400 uppercase mb-3 px-2 mt-3">æ–‡æ¡£åˆ—è¡¨</h3>
            <div id="articleList" class="space-y-2">
                <!-- æ–‡ç« åˆ—è¡¨å°†é€šè¿‡ JS åŠ¨æ€ç”Ÿæˆ -->
                <!-- ç¤ºä¾‹é¡¹ -->
                <!--
                <div class="group flex items-center justify-between p-3 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 cursor-pointer transition-colors border border-transparent hover:border-slate-200 dark:hover:border-slate-600">
                    <div class="flex-1 min-w-0">
                        <div class="font-medium text-slate-700 dark:text-slate-200 truncate">æ— æ ‡é¢˜æ–‡æ¡£</div>
                        <div class="text-xs text-slate-400 mt-1">2023-12-15 14:30</div>
                    </div>
                    <button class="opacity-0 group-hover:opacity-100 text-slate-400 hover:text-red-500 p-1 transition-opacity">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
                -->
            </div>
        </div>
    </div>

    <!-- è®¾ç½®ä¾§è¾¹æ  -->
    <div id="settingsOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden transition-opacity duration-300 opacity-0" onclick="closeSettings()"></div>
    <div id="settingsSidebar" class="fixed top-0 right-0 w-80 h-full bg-white dark:bg-slate-800 z-50 transform translate-x-full transition-transform duration-300 flex flex-col">
        <div class="p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center">
            <h3 class="font-bold text-lg text-slate-800 dark:text-white">è®¾ç½®</h3>
            <button onclick="closeSettings()" class="text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        
        <div class="flex-1 overflow-y-auto p-6 space-y-8">
            <!-- API è®¾ç½® -->
            <div>
                <div class="mb-4">
                    <div class="flex items-center gap-2 mb-3">
                        <h4 class="font-bold text-slate-700 dark:text-slate-200 flex items-center gap-2">
                            <i class="fas fa-key text-blue-500"></i> API é…ç½®
                        </h4>
                        <div class="relative inline-block">
                            <button class="peer w-5 h-5 rounded-full bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-400 hover:bg-blue-100 dark:hover:bg-blue-900/30 hover:text-blue-600 dark:hover:text-blue-400 transition-colors flex items-center justify-center text-xs">
                                <i class="fas fa-question"></i>
                            </button>
                            <div class="hidden peer-hover:block hover:block absolute left-0 top-full mt-1 w-[280px] bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-lg shadow-2xl p-2.5 z-[9999]">
                                <h5 class="font-bold text-[10px] text-slate-700 dark:text-slate-200 mb-1.5 flex items-center gap-1">
                                    <i class="fas fa-info-circle text-blue-500"></i> ä»€ä¹ˆæ˜¯ API é…ç½®ï¼Ÿ
                                </h5>
                                <div class="text-[10px] text-slate-600 dark:text-slate-400 space-y-1 leading-snug">
                                    <p><strong class="text-slate-700 dark:text-slate-300">API Keyï¼š</strong>AIæœåŠ¡å•†èº«ä»½å¯†é’¥</p>
                                    <p><strong class="text-slate-700 dark:text-slate-300">Base URLï¼š</strong>APIæœåŠ¡å™¨åœ°å€</p>
                                    <p><strong class="text-slate-700 dark:text-slate-300">Model Nameï¼š</strong>AIæ¨¡å‹åç§°</p>
                                    <div class="pt-1 mt-1 border-t border-slate-200 dark:border-slate-700">
                                        <p class="text-blue-600 dark:text-blue-400"><i class="fas fa-lightbulb"></i> è¯·æŸ¥çœ‹æ‚¨çš„APIæä¾›å•†çš„æ–‡æ¡£é…ç½®</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1">API Key</label>
                        <div class="relative">
                            <input type="password" id="apiKey" placeholder="sk-..." class="w-full border border-slate-300 dark:border-slate-600 rounded-lg p-2 pr-10 text-sm bg-white dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                            <button onclick="toggleApiKeyVisibility()" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                                <i class="fas fa-eye" id="apiKeyIcon"></i>
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1">Base URL</label>
                        <input type="text" id="apiBaseUrl" placeholder="https://api.openai.com/v1" value="https://api.longcat.chat/openai" class="w-full border border-slate-300 dark:border-slate-600 rounded-lg p-2 text-sm bg-white dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-slate-500 dark:text-slate-400 mb-1">Model Name</label>
                        <input type="text" id="apiModel" placeholder="gpt-3.5-turbo" value="LongCat-Flash-Chat" class="w-full border border-slate-300 dark:border-slate-600 rounded-lg p-2 text-sm bg-white dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <!-- å®‰å…¨æç¤º -->
                    <div class="text-xs text-yellow-600 dark:text-yellow-500 bg-yellow-50 dark:bg-yellow-900/20 p-2.5 rounded-lg border border-yellow-200 dark:border-yellow-800">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <strong>å®‰å…¨æç¤ºï¼š</strong>API Key ä»…å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ï¼Œè¯·å‹¿åœ¨å…¬å…±è®¾å¤‡ä¸Šä½¿ç”¨
                    </div>
                </div>
            </div>

            <!-- ç•Œé¢è®¾ç½® -->
            <div>
                <h4 class="font-bold text-slate-700 dark:text-slate-200 mb-4 flex items-center gap-2">
                    <i class="fas fa-paint-brush text-purple-500"></i> ç•Œé¢å¤–è§‚
                </h4>
                <div>
                    <label class="block text-xs font-medium text-slate-500 dark:text-slate-400 mb-2">ä¸»é¢˜æ¨¡å¼</label>
                    <select id="themeSelect" onchange="handleThemeChange(this.value)" class="w-full border border-slate-300 dark:border-slate-600 rounded-lg p-2 text-sm bg-white dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
                        <option value="system">è·Ÿéšç³»ç»Ÿ</option>
                        <option value="light">æµ…è‰²æ¨¡å¼</option>
                        <option value="dark">æ·±è‰²æ¨¡å¼</option>
                    </select>
                </div>
            </div>

            <!-- è‡ªå®šä¹‰ Prompt è®¾ç½® (Req: User Custom Prompt) -->
            <div>
                <h4 class="font-bold text-slate-700 dark:text-slate-200 mb-4 flex items-center gap-2">
                    <i class="fas fa-robot text-green-500"></i> AI æç¤ºè¯è®¾ç½®
                </h4>
                <div class="bg-slate-50 dark:bg-slate-900/50 rounded-lg p-4 border border-slate-100 dark:border-slate-700">
                    <div class="flex justify-between items-center mb-3">
                        <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase">
                            å½“å‰æ¨¡å¼ï¼š<span id="currentModeLabel" class="text-blue-600 dark:text-blue-400">å¿«é€Ÿæˆæ–‡</span>
                        </label>
                        <button onclick="resetCurrentPrompt()" class="text-xs text-slate-400 hover:text-red-500 transition-colors flex items-center gap-1">
                            <i class="fas fa-undo-alt"></i> æ¢å¤é»˜è®¤
                        </button>
                    </div>
                    <textarea id="modePromptInput" rows="6" class="w-full border-slate-300 dark:border-slate-600 rounded-lg text-xs p-3 bg-white dark:bg-slate-800 dark:text-white border focus:border-blue-500 outline-none resize-none leading-relaxed shadow-sm" placeholder="åœ¨æ­¤è‡ªå®šä¹‰å½“å‰æ¨¡å¼çš„ AI æç¤ºè¯..."></textarea>
                    <p class="text-[10px] text-slate-400 mt-2 flex items-start gap-1">
                        <i class="fas fa-info-circle mt-0.5"></i>
                        <span>æ­¤æç¤ºè¯å°†æ›¿æ¢è¯¥æ¨¡å¼ä¸‹çš„é»˜è®¤æŒ‡ä»¤ã€‚ä¿®æ”¹è‡ªåŠ¨ä¿å­˜ã€‚</span>
                    </p>
                </div>
            </div>

            <!-- å¸¸ç”¨æ¨¡æ¿ç®¡ç† -->
            <div>
                <h4 class="font-bold text-slate-700 dark:text-slate-200 mb-4 flex items-center gap-2">
                    <i class="fas fa-file-alt text-orange-500"></i> å¸¸ç”¨æ¨¡æ¿
                </h4>
                
                <!-- ä¿å­˜ä¸ºæ¨¡æ¿æŒ‰é’® -->
                <button onclick="saveAsTemplate()" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-2.5 rounded-lg shadow mb-3 transition flex items-center justify-center gap-2 font-medium text-sm">
                    <i class="fas fa-save"></i> ä¿å­˜å½“å‰è®¾ç½®ä¸ºæ¨¡æ¿
                </button>
                
                <!-- æ¨¡æ¿åˆ—è¡¨ -->
                <div id="templateList" class="space-y-2 mb-3">
                    <!-- æ¨¡æ¿åˆ—è¡¨å°†ç”± JS åŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <!-- å¯¼å…¥å¯¼å‡ºæŒ‰é’® -->
                <div class="flex gap-2">
                    <button onclick="exportTemplates()" class="flex-1 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 py-2 rounded-lg transition flex items-center justify-center gap-2 text-xs">
                        <i class="fas fa-download"></i> å¯¼å‡º
                    </button>
                    <button onclick="importTemplates()" class="flex-1 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 py-2 rounded-lg transition flex items-center justify-center gap-2 text-xs">
                        <i class="fas fa-upload"></i> å¯¼å…¥
                    </button>
                </div>
                
                <p class="text-[10px] text-slate-400 mt-2 flex items-start gap-1">
                    <i class="fas fa-info-circle mt-0.5"></i>
                    <span>ç‚¹å‡»æ¨¡æ¿å¿«é€Ÿåº”ç”¨è®¾ç½®ã€‚ç³»ç»Ÿæ¨¡æ¿ä¸å¯åˆ é™¤ã€‚</span>
                </p>
            </div>
        </div>
        
        <div class="p-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-center text-xs text-slate-400">
            Student Writing AI Assistant v2.2
        </div>
    </div>

    <!-- æ‚¬æµ®èŠå¤©æŒ‰é’® -->
    <button onclick="toggleChatWindow()" class="fixed bottom-8 right-8 w-14 h-14 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg flex items-center justify-center text-2xl transition-transform hover:scale-110 z-50" title="è¯¢é—® AI">
        <i class="fas fa-comments"></i>
    </button>

    <!-- AIå¯¹è¯å¼•å¯¼å¼¹çª— -->
    <div id="chatGuide" class="fixed bottom-24 right-8 hidden opacity-0 scale-95 transition-all duration-300 z-50">
        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-4 rounded-lg shadow-2xl max-w-xs relative animate-bounce">
            <button onclick="hideChatGuide()" class="absolute top-2 right-2 text-white/80 hover:text-white transition-colors">
                <i class="fas fa-times text-sm"></i>
            </button>
            <div class="flex items-start gap-3">
                <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                    <i class="fas fa-robot text-xl"></i>
                </div>
                <div>
                    <div class="font-bold text-lg mb-1">ğŸ’¡ æç¤º</div>
                    <div class="text-sm leading-relaxed">
                        å¯¹æ–‡ç« æœ‰ç–‘é—®ï¼Ÿ<br>
                        <span class="font-semibold">è¯¢é—® AI</span> è·å–å³æ—¶å¸®åŠ©ï¼
                    </div>
                </div>
            </div>
            <div class="absolute -bottom-2 right-12 w-4 h-4 bg-purple-600 transform rotate-45"></div>
        </div>
    </div>

    <!-- èŠå¤©çª—å£ -->
    <div id="chatWindow" class="fixed bottom-24 right-8 w-96 h-[500px] bg-white dark:bg-slate-800 rounded-xl shadow-2xl border border-slate-200 dark:border-slate-700 flex flex-col z-50 hidden transition-all duration-300 transform origin-bottom-right scale-95 opacity-0">
        <!-- å¤´éƒ¨ -->
        <div class="p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900 rounded-t-xl">
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                <h3 class="font-bold text-slate-700 dark:text-white">AI å†™ä½œåŠ©æ‰‹</h3>
            </div>
            <button onclick="toggleChatWindow()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- æ¶ˆæ¯åˆ—è¡¨ -->
        <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50 dark:bg-slate-900/50">
            <!-- æ¬¢è¿æ¶ˆæ¯ -->
            <div class="flex gap-3">
                <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-robot text-blue-600 dark:text-blue-400 text-sm"></i>
                </div>
                <div class="bg-white dark:bg-slate-800 p-3 rounded-lg rounded-tl-none shadow-sm border border-slate-100 dark:border-slate-700 text-sm text-slate-700 dark:text-slate-300 max-w-[85%]">
                    ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ AI å†™ä½œåŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¸®ä½ è§£ç­”å…³äºè¿™ç¯‡æ–‡ç« çš„é—®é¢˜ï¼Œæˆ–è€…æä¾›ä¿®æ”¹å»ºè®®ã€‚
                </div>
            </div>
        </div>

        <!-- è¾“å…¥æ¡† -->
        <div class="p-4 bg-white dark:bg-slate-800 border-t border-slate-100 dark:border-slate-700 rounded-b-xl">
            <div class="relative">
                <textarea id="chatInput" rows="1" class="w-full pr-10 pl-4 py-3 bg-slate-100 dark:bg-slate-700 border-none rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none resize-none dark:text-white" placeholder="è¾“å…¥é—®é¢˜... (Enter å‘é€)" onkeydown="handleChatInput(event)"></textarea>
                <button onclick="sendChatMessage()" class="absolute right-2 bottom-2 p-1.5 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-slate-600 rounded transition">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- å¯¼å‡ºåŠŸèƒ½ä¾èµ–åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- æ ¸å¿ƒæ¨¡å— - æŒ‰ä¾èµ–é¡ºåºåŠ è½½ -->
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/prompt.js"></script>
    <script src="js/editor.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/export.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
</body>
</html>